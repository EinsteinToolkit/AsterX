(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     50484,       1245]
NotebookOptionsPosition[     46730,       1175]
NotebookOutlinePosition[     47380,       1196]
CellTagsIndexPosition[     47337,       1193]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Piece of Cake coordinates", "Title",
 CellChangeTimes->{{3.842480859572761*^9, 3.8424808734034557`*^9}, {
  3.842742869283586*^9, 3.842742878013317*^9}, {3.843003248017685*^9, 
  3.843003253996933*^9}, {3.843838607912539*^9, 
  3.8438386131860456`*^9}},ExpressionUUID->"06cf51ac-2049-45e5-befb-\
5e7a3ea14fb4"],

Cell[CellGroupData[{

Cell["Coordinate system description", "Section",
 CellChangeTimes->{{3.855773081862537*^9, 
  3.855773086192668*^9}},ExpressionUUID->"9579f520-6487-4166-93f9-\
3d52dfaaed63"],

Cell[TextData[{
 "The coordinates used here are based upon \
https://arxiv.org/abs/gr-qc/0512001v1.\nEach patch will use local coordinates \
labeled ",
 Cell[BoxData[
  FormBox[
   RowBox[{"(", 
    RowBox[{"a", ",", "b", ",", "c"}], ")"}], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "89a6fe49-b057-48bd-baee-d879501aba05"],
 " limited to the ",
 Cell[BoxData[
  FormBox[
   RowBox[{"[", 
    RowBox[{
     RowBox[{"-", "1"}], ",", "1"}], "]"}], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "2f1a7a89-6e31-47d0-92fb-f8d9290e248e"],
 " range and is embedded in a global Cartesian coordinate system with \
coordinates ",
 Cell[BoxData[
  FormBox[
   RowBox[{"(", 
    RowBox[{"x", ",", "y", ",", "z"}], ")"}], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "1bd5ddbc-7d0b-42c6-9ef9-e018ca45a581"],
 ".  The ",
 Cell[BoxData[
  FormBox["c", TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "ddaca7aa-12f1-48a0-9161-14808956f370"],
 " coordinate is radial while the remaining two are angular. The ",
 Cell[BoxData[
  FormBox[
   RowBox[{"+", "x"}], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "ca311297-dec8-4f62-b277-da856ecb45d7"],
 " patch is defined and all other patches are rotations of it."
}], "Text",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQA2IQrfvGeovvrjeOVx5pbwXRepOy2v2AtMDmHV0gOu7o
9N0gOumX5l4Q/aaV6SqItrd4eANEZ0ztewaiP39KfQWiFX5+FPEH0g9i5MRA
dN1sHSsQPe3cPUcQ7XH2RRGIjmk5UAqitY58eQGie3JKvoDoihP/QwJA9tbV
hYLotu6TpSC69k5GDYhe+0amF0R/4/89CUQ7M/TNBNE1x9png+gb36QWgGil
i+vAtEhCxxIQbbDi4FIQ3WR6ZhWIPj+xeA2ItnGKkw4E0reezAPTrMZxGiD6
wNM9xiDaJi47DUTvEJTOBNENTZKzg0D2rBNZCKL3XJv+FkRvufLuM4jW+jBB
MBhIF2zbCqYBDJTB5g==
  
  "],ExpressionUUID->"6b97c8f2-ddfa-476d-b0bf-a5e6f3eadff9"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Patch system skeleton", "Section",
 CellChangeTimes->{{3.8448108646711617`*^9, 3.844810871321*^9}, {
  3.845641104146451*^9, 3.845641105656435*^9}, {3.8456414906301517`*^9, 
  3.845641495240016*^9}, {3.845641576798369*^9, 
  3.845641578368043*^9}},ExpressionUUID->"601eacfc-d37b-4778-b351-\
75911fbad235"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "CakePlusX", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CakePlusX", "=", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"baseX", "[", 
       RowBox[{"a", ",", "b", ",", "c"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"baseY", "[", 
       RowBox[{"a", ",", "b", ",", "c"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"baseZ", "[", 
       RowBox[{"a", ",", "b", ",", "c"}], "]"}]}], "\[IndentingNewLine]", 
     "}"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "CakeMinusX", "]"}], ";"}], "\[IndentingNewLine]", 

 RowBox[{
  RowBox[{
   RowBox[{"CakeMinusX", "=", 
    RowBox[{
     RowBox[{"RotationMatrix", "[", 
      RowBox[{"\[Pi]", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ".", 
     "CakePlusX"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "CakePlusY", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CakePlusY", "=", 
    RowBox[{
     RowBox[{"RotationMatrix", "[", 
      RowBox[{
       RowBox[{"\[Pi]", "/", "2"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ".", 
     "CakePlusX"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "CakeMinusY", "]"}], ";"}], "\[IndentingNewLine]", 

 RowBox[{
  RowBox[{
   RowBox[{"CakeMinusY", "=", 
    RowBox[{
     RowBox[{"RotationMatrix", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "\[Pi]"}], "/", "2"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ".", 
     "CakePlusX"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "CakePlusZ", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CakePlusZ", "=", 
    RowBox[{
     RowBox[{"RotationMatrix", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "\[Pi]"}], "/", "2"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ".", 
     "CakePlusX"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "CakeMinusZ", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CakeMinusZ", "=", 
   RowBox[{
    RowBox[{"RotationMatrix", "[", 
     RowBox[{
      RowBox[{"\[Pi]", "/", "2"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ".", 
    "CakePlusX"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.844432718702897*^9, 3.844432723490147*^9}, {
   3.844433003156488*^9, 3.844433027865608*^9}, {3.8444330937849827`*^9, 
   3.8444331069452744`*^9}, {3.8444332271426497`*^9, 
   3.8444333036133537`*^9}, {3.844433367962267*^9, 3.84443338179132*^9}, {
   3.844434003260775*^9, 3.844434030999547*^9}, {3.8444349425299797`*^9, 
   3.844434947688848*^9}, {3.844437113018725*^9, 3.844437116197493*^9}, {
   3.844437180747018*^9, 3.844437206146435*^9}, {3.844437684536944*^9, 
   3.844437764755073*^9}, {3.844438089981491*^9, 3.844438101659445*^9}, {
   3.844443350154336*^9, 3.844443354553878*^9}, 3.84444579101473*^9, 
   3.84444590438314*^9, {3.844446058899844*^9, 3.8444461060191927`*^9}, {
   3.844457535066834*^9, 3.844457591975732*^9}, {3.8444579741957607`*^9, 
   3.844458003434993*^9}, 3.844458249267202*^9, 3.844458294072276*^9, 
   3.844458367908342*^9, {3.844458398437764*^9, 3.8444584334594316`*^9}, {
   3.844458470739402*^9, 3.8444584733883657`*^9}, {3.844458596140977*^9, 
   3.844458600392589*^9}, {3.844458751570125*^9, 3.84445882387059*^9}, {
   3.8444594706433973`*^9, 3.844459474363484*^9}, {3.844810146956689*^9, 
   3.8448101877093067`*^9}, {3.84481045029561*^9, 3.844810493598917*^9}, {
   3.844810608559704*^9, 3.8448106316768827`*^9}, {3.844811023159759*^9, 
   3.844811023409419*^9}, {3.8456409139815474`*^9, 3.845640917190625*^9}, {
   3.845641109157414*^9, 3.8456411174383307`*^9}, {3.845641377892755*^9, 
   3.845641447331727*^9}, {3.845641505021315*^9, 3.845641567398898*^9}, {
   3.855784326894327*^9, 3.8557843272308807`*^9}, {3.855784406268498*^9, 
   3.8557844867461443`*^9}, {3.8557846396915703`*^9, 3.855784656878216*^9}, {
   3.856989776211707*^9, 3.856989778690833*^9}, {3.8569902072950363`*^9, 
   3.856990209882496*^9}, {3.857056977283764*^9, 3.8570569787419567`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"186ffb67-217b-4d86-ae44-abe7bc14f2bc"]
}, Closed]],

Cell[CellGroupData[{

Cell["Base Coordinate transformations", "Section",
 CellChangeTimes->{{3.845644776513996*^9, 
  3.8456447811240377`*^9}},ExpressionUUID->"28125e6d-7567-46e8-bdea-\
e105700b528e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"core", ",", "baseX", ",", "baseY", ",", "baseZ"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"core", "[", 
    RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], "=", 
   FractionBox[
    RowBox[{
     RowBox[{"r0", 
      RowBox[{"(", 
       RowBox[{"1", "-", "c"}], ")"}]}], "+", 
     RowBox[{"r1", 
      RowBox[{"(", 
       RowBox[{"1", "+", "c"}], ")"}]}]}], 
    SqrtBox[
     RowBox[{"4", "+", 
      RowBox[{"2", 
       SuperscriptBox["a", "2"], " ", 
       RowBox[{"(", 
        RowBox[{"1", "+", "c"}], ")"}]}], "+", 
      RowBox[{"2", 
       SuperscriptBox["b", "2"], " ", 
       RowBox[{"(", 
        RowBox[{"1", "+", "c"}], ")"}]}]}]]]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"baseX", "[", 
    RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], "=", 
   RowBox[{"core", "[", 
    RowBox[{"a", ",", "b", ",", "c"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"baseY", "[", 
    RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], "=", 
   RowBox[{"b", "*", 
    RowBox[{"core", "[", 
     RowBox[{"a", ",", "b", ",", "c"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"baseZ", "[", 
    RowBox[{"a_", ",", "b_", ",", "c_"}], "]"}], "=", 
   RowBox[{"a", "*", 
    RowBox[{"core", "[", 
     RowBox[{"a", ",", "b", ",", "c"}], "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.845685995498473*^9, 3.8456860213183527`*^9}, {
   3.845686092678422*^9, 3.845686095376782*^9}, {3.8457426756233673`*^9, 
   3.845742685782091*^9}, {3.845976895694695*^9, 3.845976967461896*^9}, {
   3.846084312082247*^9, 3.8460843284206867`*^9}, {3.8474899559526253`*^9, 
   3.847489957401607*^9}, {3.855677492210058*^9, 3.855677518495707*^9}, {
   3.8557821387356977`*^9, 3.85578218470478*^9}, 3.855782981161112*^9, {
   3.8557831904274*^9, 3.8557831979057198`*^9}, {3.855784017504313*^9, 
   3.855784026390643*^9}, {3.85578449830157*^9, 3.855784527301095*^9}, {
   3.855784595669726*^9, 3.8557846101890793`*^9}, {3.855784673781878*^9, 
   3.855784741067087*^9}, {3.8557852048433437`*^9, 3.85578520857868*^9}, 
   3.855785832817123*^9, {3.8557859350261087`*^9, 3.855785936513648*^9}, {
   3.855785995944268*^9, 3.8557860018838577`*^9}, {3.857057011522065*^9, 
   3.8570570120706377`*^9}, {3.857120142327916*^9, 3.857120151907593*^9}, {
   3.857120904773484*^9, 3.857120941976671*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"ccc13385-1f22-4f6c-9748-5297dd2c96be"]
}, Closed]],

Cell[CellGroupData[{

Cell["Inverse patch system", "Section",
 CellChangeTimes->{{3.857056991961061*^9, 
  3.857056999190064*^9}},ExpressionUUID->"5392b4bf-eae1-436c-9b55-\
33c24ba6b070"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"InverseCakePlusX", ",", "InversCakeMinusX"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"InverseCakePlusX", "=", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"a", ",", "b", ",", "c"}], "}"}], "//.", 
   RowBox[{"FullSimplify", "[", 
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{"CakePlusX", "\[Equal]", 
        RowBox[{"{", 
         RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"a", ",", "b", ",", "c"}], "}"}]}], "]"}], 
     "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"InverseCakeMinusX", "=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", "b", ",", "c"}], "}"}], "//.", 
    RowBox[{"FullSimplify", "[", 
     RowBox[{
      RowBox[{"Solve", "[", 
       RowBox[{
        RowBox[{"CakeMinusX", "\[Equal]", 
         RowBox[{"{", 
          RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b", ",", "c"}], "}"}]}], "]"}], 
      "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"InverseCakePlusY", ",", "InversCakeMinusY"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"InverseCakePlusY", "=", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"a", ",", "b", ",", "c"}], "}"}], "//.", 
   RowBox[{"FullSimplify", "[", 
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{"CakePlusY", "\[Equal]", 
        RowBox[{"{", 
         RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"a", ",", "b", ",", "c"}], "}"}]}], "]"}], 
     "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"InverseCakeMinusY", "=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", "b", ",", "c"}], "}"}], "//.", 
    RowBox[{"FullSimplify", "[", 
     RowBox[{
      RowBox[{"Solve", "[", 
       RowBox[{
        RowBox[{"CakeMinusY", "\[Equal]", 
         RowBox[{"{", 
          RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b", ",", "c"}], "}"}]}], "]"}], 
      "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"InverseCakePlusZ", ",", "InversCakeMinusZ"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"InverseCakePlusZ", "=", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"a", ",", "b", ",", "c"}], "}"}], "//.", 
   RowBox[{"FullSimplify", "[", 
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{"CakePlusZ", "\[Equal]", 
        RowBox[{"{", 
         RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"a", ",", "b", ",", "c"}], "}"}]}], "]"}], 
     "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"InverseCakeMinusZ", "=", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"a", ",", "b", ",", "c"}], "}"}], "//.", 
   RowBox[{"FullSimplify", "[", 
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{
       RowBox[{"CakeMinusZ", "\[Equal]", 
        RowBox[{"{", 
         RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"a", ",", "b", ",", "c"}], "}"}]}], "]"}], 
     "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
    "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.8570570174413424`*^9, 3.857057141568885*^9}, {
  3.8570583489477873`*^9, 3.8570584317736197`*^9}, {3.85756487579876*^9, 
  3.857564878027144*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"c3448815-2757-402a-91c2-fe6d15fd0f88"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   FractionBox["z", "x"], ",", 
   FractionBox["y", "x"], ",", 
   FractionBox[
    RowBox[{
     SuperscriptBox["r0", "2"], "-", 
     SuperscriptBox["r1", "2"], "+", 
     SuperscriptBox["y", "2"], "+", 
     SuperscriptBox["z", "2"], "+", 
     SqrtBox[
      RowBox[{
       RowBox[{"4", " ", 
        SuperscriptBox["r1", "2"], " ", 
        SuperscriptBox["x", "2"]}], "+", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["y", "2"], "+", 
          SuperscriptBox["z", "2"]}], ")"}], "2"], "+", 
       RowBox[{"4", " ", 
        SuperscriptBox["r0", "2"], " ", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["x", "2"], "+", 
          SuperscriptBox["y", "2"], "+", 
          SuperscriptBox["z", "2"]}], ")"}]}], "-", 
       RowBox[{"4", " ", "r0", " ", "r1", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", " ", 
           SuperscriptBox["x", "2"]}], "+", 
          SuperscriptBox["y", "2"], "+", 
          SuperscriptBox["z", "2"]}], ")"}]}]}]]}], 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"r0", "-", "r1"}], ")"}], "2"]]}], "}"}]], "Output",
 CellChangeTimes->{{3.857057089476038*^9, 3.857057141989627*^9}, {
   3.857058362738216*^9, 3.857058432345921*^9}, 3.8571209333804092`*^9, 
   3.8574960542735662`*^9, 3.857496592314343*^9, 3.857564611859125*^9, 
   3.857564752642743*^9, {3.85756485831779*^9, 3.8575648872648497`*^9}, 
   3.857567702856256*^9, 3.85757450582031*^9, 3.858069520638177*^9, {
   3.8580695809126997`*^9, 3.8580695845771923`*^9}, 3.8580696244514933`*^9, 
   3.858069998933434*^9, 3.858070420010693*^9},
 CellLabel->"Out[19]=",ExpressionUUID->"c7402aac-3241-4840-95e3-12e5acc299ad"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", 
    FractionBox["z", "x"]}], ",", 
   FractionBox["y", "x"], ",", 
   FractionBox[
    RowBox[{
     SuperscriptBox["r0", "2"], "-", 
     SuperscriptBox["r1", "2"], "+", 
     SuperscriptBox["y", "2"], "+", 
     SuperscriptBox["z", "2"], "+", 
     SqrtBox[
      RowBox[{
       RowBox[{"4", " ", 
        SuperscriptBox["r1", "2"], " ", 
        SuperscriptBox["x", "2"]}], "+", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["y", "2"], "+", 
          SuperscriptBox["z", "2"]}], ")"}], "2"], "+", 
       RowBox[{"4", " ", 
        SuperscriptBox["r0", "2"], " ", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["x", "2"], "+", 
          SuperscriptBox["y", "2"], "+", 
          SuperscriptBox["z", "2"]}], ")"}]}], "-", 
       RowBox[{"4", " ", "r0", " ", "r1", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", " ", 
           SuperscriptBox["x", "2"]}], "+", 
          SuperscriptBox["y", "2"], "+", 
          SuperscriptBox["z", "2"]}], ")"}]}]}]]}], 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"r0", "-", "r1"}], ")"}], "2"]]}], "}"}]], "Output",
 CellChangeTimes->{{3.857057089476038*^9, 3.857057141989627*^9}, {
   3.857058362738216*^9, 3.857058432345921*^9}, 3.8571209333804092`*^9, 
   3.8574960542735662`*^9, 3.857496592314343*^9, 3.857564611859125*^9, 
   3.857564752642743*^9, {3.85756485831779*^9, 3.8575648872648497`*^9}, 
   3.857567702856256*^9, 3.85757450582031*^9, 3.858069520638177*^9, {
   3.8580695809126997`*^9, 3.8580695845771923`*^9}, 3.8580696244514933`*^9, 
   3.858069998933434*^9, 3.858070420054248*^9},
 CellLabel->"Out[20]=",ExpressionUUID->"cef6aac2-4bb7-4388-a3d7-1c3bb1eae184"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   FractionBox["z", "y"], ",", 
   RowBox[{"-", 
    FractionBox["x", "y"]}], ",", 
   FractionBox[
    RowBox[{
     SuperscriptBox["r0", "2"], "-", 
     SuperscriptBox["r1", "2"], "+", 
     SuperscriptBox["x", "2"], "+", 
     SuperscriptBox["z", "2"], "+", 
     SqrtBox[
      RowBox[{
       RowBox[{"4", " ", 
        SuperscriptBox["r1", "2"], " ", 
        SuperscriptBox["y", "2"]}], "+", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["x", "2"], "+", 
          SuperscriptBox["z", "2"]}], ")"}], "2"], "+", 
       RowBox[{"4", " ", 
        SuperscriptBox["r0", "2"], " ", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["x", "2"], "+", 
          SuperscriptBox["y", "2"], "+", 
          SuperscriptBox["z", "2"]}], ")"}]}], "-", 
       RowBox[{"4", " ", "r0", " ", "r1", " ", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["x", "2"], "+", 
          RowBox[{"2", " ", 
           SuperscriptBox["y", "2"]}], "+", 
          SuperscriptBox["z", "2"]}], ")"}]}]}]]}], 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"r0", "-", "r1"}], ")"}], "2"]]}], "}"}]], "Output",
 CellChangeTimes->{{3.857057089476038*^9, 3.857057141989627*^9}, {
   3.857058362738216*^9, 3.857058432345921*^9}, 3.8571209333804092`*^9, 
   3.8574960542735662`*^9, 3.857496592314343*^9, 3.857564611859125*^9, 
   3.857564752642743*^9, {3.85756485831779*^9, 3.8575648872648497`*^9}, 
   3.857567702856256*^9, 3.85757450582031*^9, 3.858069520638177*^9, {
   3.8580695809126997`*^9, 3.8580695845771923`*^9}, 3.8580696244514933`*^9, 
   3.858069998933434*^9, 3.858070420357399*^9},
 CellLabel->"Out[22]=",ExpressionUUID->"bc53804e-cca1-4047-bbee-c46593379e93"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", 
    FractionBox["z", "y"]}], ",", 
   RowBox[{"-", 
    FractionBox["x", "y"]}], ",", 
   FractionBox[
    RowBox[{
     SuperscriptBox["r0", "2"], "-", 
     SuperscriptBox["r1", "2"], "+", 
     SuperscriptBox["x", "2"], "+", 
     SuperscriptBox["z", "2"], "+", 
     SqrtBox[
      RowBox[{
       RowBox[{"4", " ", 
        SuperscriptBox["r1", "2"], " ", 
        SuperscriptBox["y", "2"]}], "+", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["x", "2"], "+", 
          SuperscriptBox["z", "2"]}], ")"}], "2"], "+", 
       RowBox[{"4", " ", 
        SuperscriptBox["r0", "2"], " ", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["x", "2"], "+", 
          SuperscriptBox["y", "2"], "+", 
          SuperscriptBox["z", "2"]}], ")"}]}], "-", 
       RowBox[{"4", " ", "r0", " ", "r1", " ", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["x", "2"], "+", 
          RowBox[{"2", " ", 
           SuperscriptBox["y", "2"]}], "+", 
          SuperscriptBox["z", "2"]}], ")"}]}]}]]}], 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"r0", "-", "r1"}], ")"}], "2"]]}], "}"}]], "Output",
 CellChangeTimes->{{3.857057089476038*^9, 3.857057141989627*^9}, {
   3.857058362738216*^9, 3.857058432345921*^9}, 3.8571209333804092`*^9, 
   3.8574960542735662`*^9, 3.857496592314343*^9, 3.857564611859125*^9, 
   3.857564752642743*^9, {3.85756485831779*^9, 3.8575648872648497`*^9}, 
   3.857567702856256*^9, 3.85757450582031*^9, 3.858069520638177*^9, {
   3.8580695809126997`*^9, 3.8580695845771923`*^9}, 3.8580696244514933`*^9, 
   3.858069998933434*^9, 3.858070420399416*^9},
 CellLabel->"Out[23]=",ExpressionUUID->"36b2516e-f90e-409b-a093-258755d89c76"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", 
    FractionBox["x", "z"]}], ",", 
   FractionBox["y", "z"], ",", 
   FractionBox[
    RowBox[{
     SuperscriptBox["r0", "2"], "-", 
     SuperscriptBox["r1", "2"], "+", 
     SuperscriptBox["x", "2"], "+", 
     SuperscriptBox["y", "2"], "+", 
     SqrtBox[
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["x", "2"], "+", 
          SuperscriptBox["y", "2"]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"4", " ", "r0", " ", 
           RowBox[{"(", 
            RowBox[{"r0", "-", "r1"}], ")"}]}], "+", 
          SuperscriptBox["x", "2"], "+", 
          SuperscriptBox["y", "2"]}], ")"}]}], "+", 
       RowBox[{"4", " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"r0", "-", "r1"}], ")"}], "2"], " ", 
        SuperscriptBox["z", "2"]}]}]]}], 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"r0", "-", "r1"}], ")"}], "2"]]}], "}"}]], "Output",
 CellChangeTimes->{{3.857057089476038*^9, 3.857057141989627*^9}, {
   3.857058362738216*^9, 3.857058432345921*^9}, 3.8571209333804092`*^9, 
   3.8574960542735662`*^9, 3.857496592314343*^9, 3.857564611859125*^9, 
   3.857564752642743*^9, {3.85756485831779*^9, 3.8575648872648497`*^9}, 
   3.857567702856256*^9, 3.85757450582031*^9, 3.858069520638177*^9, {
   3.8580695809126997`*^9, 3.8580695845771923`*^9}, 3.8580696244514933`*^9, 
   3.858069998933434*^9, 3.8580704207325287`*^9},
 CellLabel->"Out[25]=",ExpressionUUID->"68e6f927-9bd2-4308-a4c9-825d09a3f39f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", 
    FractionBox["x", "z"]}], ",", 
   RowBox[{"-", 
    FractionBox["y", "z"]}], ",", 
   FractionBox[
    RowBox[{
     SuperscriptBox["r0", "2"], "-", 
     SuperscriptBox["r1", "2"], "+", 
     SuperscriptBox["x", "2"], "+", 
     SuperscriptBox["y", "2"], "+", 
     SqrtBox[
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["x", "2"], "+", 
          SuperscriptBox["y", "2"]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"4", " ", "r0", " ", 
           RowBox[{"(", 
            RowBox[{"r0", "-", "r1"}], ")"}]}], "+", 
          SuperscriptBox["x", "2"], "+", 
          SuperscriptBox["y", "2"]}], ")"}]}], "+", 
       RowBox[{"4", " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"r0", "-", "r1"}], ")"}], "2"], " ", 
        SuperscriptBox["z", "2"]}]}]]}], 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"r0", "-", "r1"}], ")"}], "2"]]}], "}"}]], "Output",
 CellChangeTimes->{{3.857057089476038*^9, 3.857057141989627*^9}, {
   3.857058362738216*^9, 3.857058432345921*^9}, 3.8571209333804092`*^9, 
   3.8574960542735662`*^9, 3.857496592314343*^9, 3.857564611859125*^9, 
   3.857564752642743*^9, {3.85756485831779*^9, 3.8575648872648497`*^9}, 
   3.857567702856256*^9, 3.85757450582031*^9, 3.858069520638177*^9, {
   3.8580695809126997`*^9, 3.8580695845771923`*^9}, 3.8580696244514933`*^9, 
   3.858069998933434*^9, 3.858070420774639*^9},
 CellLabel->"Out[26]=",ExpressionUUID->"ad3f6159-1673-4ac1-9e1f-5e0e43fd166a"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Rational Power decomposition", "Section",
 CellChangeTimes->{{3.8580678024798403`*^9, 3.85806781628967*^9}, {
  3.8580682519428167`*^9, 
  3.8580682570827093`*^9}},ExpressionUUID->"d6f9048d-9e79-4674-b127-\
04166c9b3da4"],

Cell[TextData[{
 "Since the implemented ",
 Cell[BoxData[
  FormBox["Power", TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "ae0a7712-74b9-4645-96d4-813ad44fa971"],
 " function can only evaluate powers of integers, we must decompose rational \
powers in terms of integer powers multiplied by roots. Since All rational \
powers that appear in the equations are multiples of ",
 Cell[BoxData[
  FormBox[
   RowBox[{"1", "/", "2"}], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "6c52106d-5869-45ac-af8e-4fef119b43fc"],
 ", we can decompose them according to\n\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox["y", 
     RowBox[{"x", "/", "2"}]], "=", 
    RowBox[{
     SuperscriptBox["y", 
      RowBox[{
       RowBox[{"Sign", "(", "x", ")"}], 
       RowBox[{"(", 
        RowBox[{"|", "x", "|", 
         RowBox[{"-", "2"}]}], ")"}]}]], 
     SuperscriptBox["y", 
      RowBox[{
       RowBox[{"Sign", "[", "x", "]"}], "/", "2"}]]}]}], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "ae45ef19-bd0a-464d-a1b0-cdc267b7af10"],
 "\n\nWhich we can implement as a substitution rule:"
}], "Text",
 CellChangeTimes->{{3.858067826608981*^9, 3.8580680138981256`*^9}, {
  3.8580680471472597`*^9, 
  3.858068148094634*^9}},ExpressionUUID->"b298a480-cbcd-4256-ac81-\
ebc8e7712cc5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "rationalPowerToSqrt", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rationalPowerToSqrt", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Power", "[", 
      RowBox[{"y_", ",", 
       RowBox[{"Rational", "[", 
        RowBox[{"x_", ",", "2"}], "]"}]}], "]"}], "\[RuleDelayed]", 
     RowBox[{
      RowBox[{
       RowBox[{"Power", "[", 
        RowBox[{
         RowBox[{"HoldForm", "[", "y", "]"}], ",", 
         RowBox[{
          RowBox[{"Sign", "[", "x", "]"}], "*", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Abs", "[", "x", "]"}], "-", "2"}], ")"}]}]}], "]"}], 
       RowBox[{"Power", "[", 
        RowBox[{"y", ",", 
         RowBox[{"Rational", "[", 
          RowBox[{
           RowBox[{"Sign", "[", "x", "]"}], ",", "2"}], "]"}]}], "]"}]}], "/;", 
      RowBox[{
       RowBox[{"Abs", "[", "x", "]"}], "\[NotEqual]", "1"}]}]}], "}"}]}], 
  ";"}]}], "Input",
 CellLabel->"In[27]:=",ExpressionUUID->"5b35faf6-89e0-4611-81bc-6105588bd272"],

Cell["A few examples of this decomposition follow:", "Text",
 CellChangeTimes->{{3.858068156454658*^9, 
  3.858068172793515*^9}},ExpressionUUID->"83888382-3834-49aa-b4d4-\
f62753bba76d"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"x", "^", 
   RowBox[{"(", 
    RowBox[{"5", "/", "2"}], ")"}]}], "//.", 
  "rationalPowerToSqrt"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"x", "^", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", "5"}], "/", "2"}], ")"}]}], "//.", 
  "rationalPowerToSqrt"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"x", "^", 
   RowBox[{"(", 
    RowBox[{"3", "/", "2"}], ")"}]}], "//.", 
  "rationalPowerToSqrt"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"x", "^", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", "3"}], "/", "2"}], ")"}]}], "//.", 
  "rationalPowerToSqrt"}]}], "Input",
 CellChangeTimes->{{3.8580681802350807`*^9, 3.858068239373993*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"059f812d-0241-45e4-a286-0e51a29d83b1"],

Cell[BoxData[
 RowBox[{
  SqrtBox["x"], " ", 
  SuperscriptBox[
   TagBox["x",
    HoldForm], "3"]}]], "Output",
 CellChangeTimes->{{3.858068189251178*^9, 3.858068239836529*^9}, 
   3.8580695214479427`*^9, {3.8580695817751837`*^9, 3.858069584832427*^9}, 
   3.8580696252805843`*^9, 3.858069999765142*^9, 3.858070420817526*^9},
 CellLabel->"Out[29]=",ExpressionUUID->"9d95ea72-6188-402f-ac33-01bf02de4954"],

Cell[BoxData[
 FractionBox["1", 
  RowBox[{
   SqrtBox["x"], " ", 
   SuperscriptBox[
    TagBox["x",
     HoldForm], "3"]}]]], "Output",
 CellChangeTimes->{{3.858068189251178*^9, 3.858068239836529*^9}, 
   3.8580695214479427`*^9, {3.8580695817751837`*^9, 3.858069584832427*^9}, 
   3.8580696252805843`*^9, 3.858069999765142*^9, 3.8580704208179827`*^9},
 CellLabel->"Out[30]=",ExpressionUUID->"c9b6ce40-d307-4acc-9e49-5503c3a7add2"],

Cell[BoxData[
 RowBox[{
  SqrtBox["x"], " ", 
  TagBox["x",
   HoldForm]}]], "Output",
 CellChangeTimes->{{3.858068189251178*^9, 3.858068239836529*^9}, 
   3.8580695214479427`*^9, {3.8580695817751837`*^9, 3.858069584832427*^9}, 
   3.8580696252805843`*^9, 3.858069999765142*^9, 3.858070420818469*^9},
 CellLabel->"Out[31]=",ExpressionUUID->"66a6aa93-243a-45e5-acff-68d74bc79ae8"],

Cell[BoxData[
 FractionBox["1", 
  RowBox[{
   SqrtBox["x"], " ", 
   TagBox["x",
    HoldForm]}]]], "Output",
 CellChangeTimes->{{3.858068189251178*^9, 3.858068239836529*^9}, 
   3.8580695214479427`*^9, {3.8580695817751837`*^9, 3.858069584832427*^9}, 
   3.8580696252805843`*^9, 3.858069999765142*^9, 3.8580704208189783`*^9},
 CellLabel->"Out[32]=",ExpressionUUID->"cd32f2c7-d16f-4684-bb7a-64cb767035af"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Jacobian code generation", "Section",
 CellChangeTimes->{{3.844820628414963*^9, 3.8448206376849527`*^9}, {
  3.8571230986806602`*^9, 
  3.8571231044308043`*^9}},ExpressionUUID->"aac8c2de-1705-4e11-82a7-\
d37ddc3603ca"],

Cell[CellGroupData[{

Cell["Jacobian file generation routine", "Subsection",
 CellChangeTimes->{{3.85807029256612*^9, 
  3.85807030329497*^9}},ExpressionUUID->"d9a6ec80-94ff-4010-a85e-\
5a76d9141abd"],

Cell[TextData[{
 "CarpetX defines\n\n",
 Cell[BoxData[{
  FormBox[
   RowBox[{
    RowBox[{
     RowBox[{"J", "[", "i", "]"}], "[", "j", "]"}], "=", 
    FractionBox[
     SuperscriptBox["da", "i"], 
     SuperscriptBox["dx", "j"]]}], TraditionalForm], "\[IndentingNewLine]", 
  FormBox[
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"dJ", "[", "i", "]"}], "[", "j", "]"}], "[", "k", "]"}], "=", 
    RowBox[{
     FractionBox["d", 
      SuperscriptBox["dx", "k"]], 
     RowBox[{"(", 
      FractionBox[
       SuperscriptBox["da", "i"], 
       SuperscriptBox["dx", "j"]], ")"}]}]}], TraditionalForm]}],
  FormatType->"TraditionalForm",ExpressionUUID->
  "e916b45b-0691-43bb-b104-b99c3792f970"],
 "\n\nThat is, we must evaluate the derivatives of all local to global \
coordinate transformations (here defined in the \
\[OpenCurlyDoubleQuote]Inverse patch system\[CloseCurlyDoubleQuote] section).\
\nTo eliminate typing errors, the Jacobian components and \
it\[CloseCurlyQuote]s derivatives are calculated and a C++ source file is \
automatically generated for each patch piece. The function bellow generates a \
Jacobian file based taking a patch name and it\[CloseCurlyQuote]s string \
conversion as input"
}], "Text",
 CellChangeTimes->{{3.8460843424597054`*^9, 3.846084494466394*^9}, {
  3.857120063429269*^9, 3.857120086484022*^9}, {3.857132591638426*^9, 
  3.857132592022197*^9}, {3.8580687165349627`*^9, 3.858068867341958*^9}, {
  3.858069271864131*^9, 3.858069323613624*^9}, {3.858069425391279*^9, 
  3.85806947653013*^9}, {3.8580702263171883`*^9, 
  3.858070287806102*^9}},ExpressionUUID->"a1dc3eef-aba1-46f5-8810-\
b875ef843746"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "generateJacobians", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"generateJacobians", "[", 
   RowBox[{"functions_", ",", "strfunctions_", ",", "outdir_"}], "]"}], ":=", 
  
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "pieceName", ",", "\[IndentingNewLine]", "functionsName", ",", 
      "\[IndentingNewLine]", "coords", ",", "\[IndentingNewLine]", "J", ",", 
      "\[IndentingNewLine]", "dJ", ",", "\[IndentingNewLine]", "filePart1", 
      ",", "\[IndentingNewLine]", "filePart2", ",", "\[IndentingNewLine]", 
      "outpath"}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pieceName", "=", 
      RowBox[{"ToLowerCase", "[", 
       RowBox[{"StringReplace", "[", 
        RowBox[{"strfunctions", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<InverseCake\>\"", "\[Rule]", "\"\<\>\""}], ",", 
           RowBox[{"\"\<Plus\>\"", "\[Rule]", "\"\<plus_\>\""}], ",", 
           RowBox[{"\"\<Minus\>\"", "\[Rule]", "\"\<minus_\>\""}]}], "}"}]}], 
        "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"functionsName", "=", 
      RowBox[{"\"\<cake_\>\"", "<>", "pieceName", "<>", "\"\<_jac\>\""}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"coords", "=", 
      RowBox[{"{", 
       RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], ";", "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"J", "[", 
       RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
      RowBox[{"FullSimplify", "[", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{
          "functions", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
           ",", 
          RowBox[{
          "coords", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}], 
         "]"}], "//.", "rationalPowerToSqrt"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dJ", "[", 
       RowBox[{"i_", ",", "j_", ",", "k_"}], "]"}], ":=", 
      RowBox[{"FullSimplify", "[", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{
          "functions", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
           ",", 
          RowBox[{
          "coords", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
          ",", 
          RowBox[{
          "coords", "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}]}], 
         "]"}], "//.", "rationalPowerToSqrt"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"filePart1", "=", 
      RowBox[{"\"\<#ifndef MULTIPATCH_\>\"", "<>", 
       RowBox[{"ToUpperCase", "[", "functionsName", "]"}], "<>", 
       "\"\<_HXX\n#define MULTIPATCH_\>\"", "<>", 
       RowBox[{"ToUpperCase", "[", "functionsName", "]"}], "<>", 
       "\"\<_HXX\n\n#include \\\"cake.hxx\\\"\n\nnamespace MultiPatch {\n\
namespace Cake {\n\ninline std_tuple<jac_t, djac_t> \>\"", "<>", 
       "functionsName", "<>", 
       "\"\<(const PatchTransformations &pt, const svec_u &local_vars) {\n  \
jac_t J{};\n  djac_t dJ{};\n\n  const auto r0 = \
pt.cake_inner_boundary_radius;\n  const auto r1 = \
pt.cake_outer_boundary_radius;\n\n  const auto global_vars = \
pt.local2global(pt, static_cast<int>(patch_piece::\>\"", "<>", "pieceName", 
       "<>", "\"\<), local_vars);\n  const auto x = global_vars(0);\n  const \
auto y = global_vars(1);\n  const auto z = global_vars(2);\n\n  \>\""}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"filePart2", "=", 
      RowBox[{
      "\"\<\n  return std::make_tuple(J, dJ);\n}\n\n} // namespace Cake\n} // \
namespace MultiPatch\n\n#endif // MULTIPATCH_\>\"", "<>", 
       RowBox[{"ToUpperCase", "[", "functionsName", "]"}], "<>", 
       "\"\<_HXX\n\>\""}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", "j"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", "3"}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "3"}], ",", 
           RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{"filePart1", "=", 
            RowBox[{"filePart1", "<>", "\"\<J(\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"i", "-", "1"}], "]"}], "<>", "\"\<)(\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"j", "-", "1"}], "]"}], "<>", "\"\<) = \>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{
               RowBox[{"J", "[", 
                RowBox[{"i", ",", "j"}], "]"}], ",", "CForm"}], "]"}], "<>", 
             "\"\<;\\n\\n  \>\""}]}]}], "\[IndentingNewLine]", "]"}]}], 
        "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", "\[IndentingNewLine]", 
       
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", "3"}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "3"}], ",", 
           RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"k", "=", "1"}], ",", 
             RowBox[{"k", "\[LessEqual]", "3"}], ",", 
             RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{"filePart1", "=", 
              RowBox[{"filePart1", "<>", "\"\<dJ(\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"i", "-", "1"}], "]"}], "<>", "\"\<)(\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"j", "-", "1"}], "]"}], "<>", "\"\<,\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"k", "-", "1"}], "]"}], "<>", "\"\<) = \>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{
                 RowBox[{"dJ", "[", 
                  RowBox[{"i", ",", "j", ",", "k"}], "]"}], ",", "CForm"}], 
                "]"}], "<>", "\"\<;\\n\\n  \>\""}]}]}], "\[IndentingNewLine]",
             "]"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
        "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"outpath", "=", 
      RowBox[{
       RowBox[{"NotebookDirectory", "[", "]"}], "<>", "outdir", "<>", 
       "functionsName", "<>", "\"\<.hxx\>\""}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"Export", "[", 
      RowBox[{"outpath", ",", 
       RowBox[{"filePart1", "<>", "filePart2"}], ",", "\"\<Text\>\""}], "]"}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"Run", "[", 
      RowBox[{"\"\<clang-format -i \>\"", "<>", "outpath"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.844555357035696*^9, 3.8445554177649097`*^9}, {
   3.844556093364773*^9, 3.844556268527671*^9}, {3.844556302037595*^9, 
   3.844556523115862*^9}, {3.844556557584216*^9, 3.844556568642921*^9}, {
   3.844556632020903*^9, 3.8445568569192142`*^9}, {3.844556906565702*^9, 
   3.844557006933517*^9}, {3.84455710890423*^9, 3.844557268051888*^9}, {
   3.844557299730859*^9, 3.844557346522697*^9}, {3.8445573846499653`*^9, 
   3.844557412931323*^9}, {3.84455747066789*^9, 3.844557773022596*^9}, {
   3.844557819467043*^9, 3.844557850158593*^9}, {3.844807631897707*^9, 
   3.8448076401246853`*^9}, {3.844811630490754*^9, 3.844811668368103*^9}, {
   3.844811705550363*^9, 3.84481173011215*^9}, {3.844820578828603*^9, 
   3.844820610905693*^9}, {3.844820662210389*^9, 3.844820949033586*^9}, {
   3.844820987633822*^9, 3.8448209958438663`*^9}, {3.846085109002692*^9, 
   3.846085149199314*^9}, {3.846085207619639*^9, 3.846085216068761*^9}, {
   3.84608527879944*^9, 3.846085327525758*^9}, {3.846085362496022*^9, 
   3.846085555016239*^9}, {3.846085587676421*^9, 3.846085645704603*^9}, {
   3.846086056143278*^9, 3.846086150227625*^9}, {3.846086292712928*^9, 
   3.846086490521125*^9}, {3.846086521052518*^9, 3.846086714063286*^9}, {
   3.846086815351478*^9, 3.8460869212278214`*^9}, {3.846086993127885*^9, 
   3.84608702566888*^9}, {3.846087077316272*^9, 3.8460871509049683`*^9}, {
   3.846104797035263*^9, 3.846104858396845*^9}, {3.846108203757223*^9, 
   3.84610823454438*^9}, 3.846108738259192*^9, {3.8461088062585363`*^9, 
   3.846108814986484*^9}, {3.846109241179256*^9, 3.846109307470105*^9}, {
   3.847412858593297*^9, 3.847412860731786*^9}, {3.847493243406959*^9, 
   3.847493253374833*^9}, {3.8478128237117968`*^9, 3.847812851737204*^9}, {
   3.847812913116078*^9, 3.84781292495599*^9}, {3.8478130683825693`*^9, 
   3.8478130805553417`*^9}, {3.847813144493271*^9, 3.8478131450215178`*^9}, {
   3.847813343369372*^9, 3.8478133522873783`*^9}, {3.847885156700234*^9, 
   3.847885173510014*^9}, {3.847885441828433*^9, 3.84788548040362*^9}, {
   3.847885517222659*^9, 3.847885571601021*^9}, {3.847885603515306*^9, 
   3.847885616300325*^9}, {3.847885750998674*^9, 3.847885786837125*^9}, {
   3.847885861900317*^9, 3.84788588603617*^9}, {3.847885935636855*^9, 
   3.847885937675232*^9}, {3.8478862139853783`*^9, 3.84788624454066*^9}, {
   3.8478862974914637`*^9, 3.8478863834584208`*^9}, {3.847886656293826*^9, 
   3.84788667987364*^9}, {3.847886742992503*^9, 3.8478867660715523`*^9}, {
   3.847886809113501*^9, 3.847886812340938*^9}, {3.8478868533318872`*^9, 
   3.8478868537702503`*^9}, {3.847886892773367*^9, 3.8478868939863253`*^9}, {
   3.847886941283746*^9, 3.847886989170039*^9}, {3.847887044819384*^9, 
   3.847887194215908*^9}, 3.847887472869638*^9, {3.8571201149813967`*^9, 
   3.857120116851118*^9}, {3.857121024613505*^9, 3.85712102770263*^9}, {
   3.8571211519813633`*^9, 3.857121180689527*^9}, {3.857121217309537*^9, 
   3.857121338839222*^9}, {3.857121372548037*^9, 3.8571214104264803`*^9}, {
   3.857121443316214*^9, 3.857121452316494*^9}, {3.8571230212270327`*^9, 
   3.8571230261241493`*^9}, {3.857123072183836*^9, 3.857123090423005*^9}, {
   3.8571231230553703`*^9, 3.8571231430025377`*^9}, {3.8571231889717197`*^9, 
   3.8571232272091103`*^9}, {3.857123262291757*^9, 3.857123369877781*^9}, {
   3.8571234042676373`*^9, 3.857123472724929*^9}, {3.8571235164154053`*^9, 
   3.8571236235317707`*^9}, {3.857123702551352*^9, 3.8571237067204943`*^9}, {
   3.8571323965244627`*^9, 3.85713241182865*^9}, {3.857132682509533*^9, 
   3.857132735616955*^9}, {3.8571327878276243`*^9, 3.8571327884859858`*^9}, {
   3.857132826308814*^9, 3.857132831419278*^9}, {3.8571328944560432`*^9, 
   3.8571329464544573`*^9}, {3.857132995315836*^9, 3.8571330258042793`*^9}, {
   3.857133367799131*^9, 3.8571333696668777`*^9}, {3.85713453080415*^9, 
   3.8571345922137213`*^9}, {3.8571360284074497`*^9, 3.857136125455098*^9}, {
   3.857496042302005*^9, 3.8574960455527287`*^9}, {3.857496135240645*^9, 
   3.85749614574711*^9}, {3.857496193353106*^9, 3.8574962704839897`*^9}, {
   3.857496501272315*^9, 3.8574965099958553`*^9}, {3.857496578769837*^9, 
   3.857496581329091*^9}, 3.857567683566287*^9, {3.857567797074243*^9, 
   3.857567838382086*^9}, {3.857567990138966*^9, 3.857568066286294*^9}, {
   3.8575744190327787`*^9, 3.857574514680072*^9}, {3.8575745473204403`*^9, 
   3.857574601437492*^9}, {3.8575746919950647`*^9, 3.8575746927156277`*^9}, {
   3.858069171196603*^9, 3.858069183739546*^9}, 3.85806926831109*^9, {
   3.8580694791822357`*^9, 3.85806950802153*^9}, {3.858069605270482*^9, 
   3.858069609679716*^9}, {3.858069667742251*^9, 3.858069695577877*^9}, {
   3.8580698021085453`*^9, 3.8580700212328157`*^9}, {3.858070124252219*^9, 
   3.858070173460717*^9}, {3.858070315909255*^9, 3.858070344831246*^9}, {
   3.858070458276539*^9, 3.8580704856456137`*^9}, {3.858070520134783*^9, 
   3.8580705480555897`*^9}, 3.858070579575614*^9, {3.8580706388042088`*^9, 
   3.858070667433056*^9}},
 CellLabel->"In[45]:=",ExpressionUUID->"a3c3d996-7249-49f2-a713-17b132aece98"]
}, Closed]],

Cell[CellGroupData[{

Cell["Generating Jacobians for all patches", "Subsection",
 CellChangeTimes->{{3.858070362764451*^9, 
  3.858070379434147*^9}},ExpressionUUID->"d99e0606-0732-452e-9b83-\
ea3fe0d77531"],

Cell[BoxData[{
 RowBox[{"generateJacobians", "[", 
  RowBox[{"InverseCakePlusX", ",", 
   RowBox[{"ToString", "[", 
    RowBox[{"HoldForm", "[", "InverseCakePlusX", "]"}], "]"}], ",", 
   "\"\<../\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"generateJacobians", "[", 
   RowBox[{"InverseCakePlusX", ",", 
    RowBox[{"ToString", "[", 
     RowBox[{"HoldForm", "[", "InverseCakeMinusX", "]"}], "]"}], ",", 
    "\"\<./\>\""}], "]"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"generateJacobians", "[", 
  RowBox[{"InverseCakePlusX", ",", 
   RowBox[{"ToString", "[", 
    RowBox[{"HoldForm", "[", "InverseCakePlusY", "]"}], "]"}], ",", 
   "\"\<../\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"generateJacobians", "[", 
   RowBox[{"InverseCakePlusX", ",", 
    RowBox[{"ToString", "[", 
     RowBox[{"HoldForm", "[", "InverseCakeMinusY", "]"}], "]"}], ",", 
    "\"\<../\>\""}], "]"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"generateJacobians", "[", 
  RowBox[{"InverseCakePlusX", ",", 
   RowBox[{"ToString", "[", 
    RowBox[{"HoldForm", "[", "InverseCakePlusZ", "]"}], "]"}], ",", 
   "\"\<../\>\""}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"generateJacobians", "[", 
  RowBox[{"InverseCakePlusX", ",", 
   RowBox[{"ToString", "[", 
    RowBox[{"HoldForm", "[", "InverseCakeMinusZ", "]"}], "]"}], ",", 
   "\"\<../\>\""}], "]"}]}], "Input",
 CellChangeTimes->{{3.858070023951836*^9, 3.858070064709405*^9}, {
  3.8580704044053087`*^9, 3.858070405573649*^9}, {3.8580707188894453`*^9, 
  3.858070743269115*^9}, {3.858072731511532*^9, 
  3.858072749900362*^9}},ExpressionUUID->"e7d8b4f8-3c5f-4568-8282-\
7e6fc8cef4b8"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1502.608695652174, 779.4782608695652},
WindowMargins->{{1502.608695652174, Automatic}, {
  Automatic, 31.64835164835165}},
TaggingRules->{
 "WelcomeScreenSettings" -> {"FEStarting" -> False}, "TryRealOnly" -> False},
DefaultNaturalLanguage->Language,
FrontEndVersion->"12.1 for Linux x86 (64-bit) (June 19, 2020)",
StyleDefinitions->FrontEnd`FileName[{"Report"}, "StandardReport.nb", 
  CharacterEncoding -> "UTF-8"],
ExpressionUUID->"c7c54479-860f-4a9a-bc66-0ea79160d210"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 316, 5, 103, "Title",ExpressionUUID->"06cf51ac-2049-45e5-befb-5e7a3ea14fb4"],
Cell[CellGroupData[{
Cell[921, 31, 174, 3, 73, "Section",ExpressionUUID->"9579f520-6487-4166-93f9-3d52dfaaed63"],
Cell[1098, 36, 1815, 48, 89, "Text",ExpressionUUID->"6b97c8f2-ddfa-476d-b0bf-a5e6f3eadff9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2950, 89, 311, 5, 73, "Section",ExpressionUUID->"601eacfc-d37b-4778-b351-75911fbad235"],
Cell[3264, 96, 4521, 103, 452, "Input",ExpressionUUID->"186ffb67-217b-4d86-ae44-abe7bc14f2bc"]
}, Closed]],
Cell[CellGroupData[{
Cell[7822, 204, 178, 3, 59, "Section",ExpressionUUID->"28125e6d-7567-46e8-bdea-e105700b528e"],
Cell[8003, 209, 2533, 64, 149, "Input",ExpressionUUID->"ccc13385-1f22-4f6c-9748-5297dd2c96be"]
}, Closed]],
Cell[CellGroupData[{
Cell[10573, 278, 165, 3, 59, "Section",ExpressionUUID->"5392b4bf-eae1-436c-9b55-33c24ba6b070"],
Cell[CellGroupData[{
Cell[10763, 285, 3820, 108, 246, "Input",ExpressionUUID->"c3448815-2757-402a-91c2-fe6d15fd0f88"],
Cell[14586, 395, 1748, 45, 70, "Output",ExpressionUUID->"c7402aac-3241-4840-95e3-12e5acc299ad"],
Cell[16337, 442, 1768, 46, 70, "Output",ExpressionUUID->"cef6aac2-4bb7-4388-a3d7-1c3bb1eae184"],
Cell[18108, 490, 1768, 46, 70, "Output",ExpressionUUID->"bc53804e-cca1-4047-bbee-c46593379e93"],
Cell[19879, 538, 1788, 47, 70, "Output",ExpressionUUID->"36b2516e-f90e-409b-a093-258755d89c76"],
Cell[21670, 587, 1572, 41, 70, "Output",ExpressionUUID->"68e6f927-9bd2-4308-a4c9-825d09a3f39f"],
Cell[23245, 630, 1590, 42, 70, "Output",ExpressionUUID->"ad3f6159-1673-4ac1-9e1f-5e0e43fd166a"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[24884, 678, 227, 4, 59, "Section",ExpressionUUID->"d6f9048d-9e79-4674-b127-04166c9b3da4"],
Cell[25114, 684, 1352, 37, 162, "Text",ExpressionUUID->"b298a480-cbcd-4256-ac81-ebc8e7712cc5"],
Cell[26469, 723, 1045, 30, 61, "Input",ExpressionUUID->"5b35faf6-89e0-4611-81bc-6105588bd272"],
Cell[27517, 755, 186, 3, 37, "Text",ExpressionUUID->"83888382-3834-49aa-b4d4-f62753bba76d"],
Cell[CellGroupData[{
Cell[27728, 762, 770, 24, 103, "Input",ExpressionUUID->"059f812d-0241-45e4-a286-0e51a29d83b1"],
Cell[28501, 788, 405, 9, 70, "Output",ExpressionUUID->"9d95ea72-6188-402f-ac33-01bf02de4954"],
Cell[28909, 799, 432, 10, 70, "Output",ExpressionUUID->"c9b6ce40-d307-4acc-9e49-5503c3a7add2"],
Cell[29344, 811, 379, 8, 70, "Output",ExpressionUUID->"66a6aa93-243a-45e5-acff-68d74bc79ae8"],
Cell[29726, 821, 405, 9, 70, "Output",ExpressionUUID->"cd32f2c7-d16f-4684-bb7a-64cb767035af"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[30180, 836, 224, 4, 59, "Section",ExpressionUUID->"aac8c2de-1705-4e11-82a7-d37ddc3603ca"],
Cell[CellGroupData[{
Cell[30429, 844, 178, 3, 37, "Subsection",ExpressionUUID->"d9a6ec80-94ff-4010-a85e-5a76d9141abd"],
Cell[30610, 849, 1650, 39, 224, "Text",ExpressionUUID->"a1dc3eef-aba1-46f5-8810-b875ef843746"],
Cell[32263, 890, 12520, 233, 1582, "Input",ExpressionUUID->"a3c3d996-7249-49f2-a713-17b132aece98"]
}, Closed]],
Cell[CellGroupData[{
Cell[44820, 1128, 184, 3, 37, "Subsection",ExpressionUUID->"d99e0606-0732-452e-9b83-ea3fe0d77531"],
Cell[45007, 1133, 1683, 37, 185, "Input",ExpressionUUID->"e7d8b4f8-3c5f-4568-8282-7e6fc8cef4b8"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

